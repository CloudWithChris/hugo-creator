{{ define "top" }}
  <section class="container">
    <div class="row my-3">
      <div class="col-md-8 col-sm-12">
        {{ $featuredContent := where .Site.Pages "Params.featured" ">" 0 }}
        {{ $featuredContentCount := len $featuredContent }}
        {{ if gt $featuredContentCount 0 }}
          <div class="row">
            <div id="featuredContent" class="carousel slide" data-bs-ride="carousel">
              <div class="carousel-indicators">
                {{ range $index, $value := $featuredContent }}
                  <button type="button" data-bs-target="#featuredContent" data-bs-slide-to="{{ $index }}" {{ if (eq $index 0) }}class="active"{{ end }} aria-current="true" aria-label="{{ $value.Title}}"></button>
                {{ end }}
              </div>
              <div class="carousel-inner">
                {{ range $index, $value := $featuredContent }}
                  <div class="carousel-item {{ if (eq $index 0) }}active{{ end }}">
                    {{ $image := .Resources.GetMatch .Params.Banner }}
                    {{ if $image }}
                      {{ template "carouselImage" dict "currentItem" .Page "url" ($image.RelPermalink | relURL) "index" $index }}
                    {{ else }}
                      {{ template "carouselImage" dict "currentItem" .Page "url" (.Params.Image | relURL) "index" $index }}
                    {{ end }}
                  </div>
                {{ end }}
              </div>
              <button class="carousel-control-prev" type="button" data-bs-target="#featuredContent" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
              </button>
              <button class="carousel-control-next" type="button" data-bs-target="#featuredContent" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
              </button>
            </div>
          </div>
        {{ end }}
      </div>
      <div class="col-4">
        {{ $comingUp := (where .Site.RegularPages ".Params.upcoming" "==" true).ByDate | first 4 }}
        {{ range $comingUp }}

        {{ $image := .Resources.GetMatch .Params.image }}

        {{ if not $image }}
          {{ $image = resources.GetMatch (.Params.Image | relURL) }}
        {{ end }}


          <div class="row h-25">
            <div class="card bg-cwc text-white">
              <div class="card-body">
                <h1 class="fs-6 card-title">{{ .Title }}</h1>
                <p class="card-text">{{ .Type | humanize }}</p>
                <p class="card-text">
                  <i class="fa-solid fa-calendar me-2"></i>
                  {{ .Date.Format "January 2, 2006" }}
                </p>
              </div>
            </div>
          </div>
        {{ end }}
      </div>
    </div>
    <div class="row">
      <div class="col-4">
        Test
      </div>
      <div class="col-4">
        Test
      </div>
      <div class="col-4">
        TEst
      </div>
    </div>
  </section>
{{ end }}


{{ define "carouselImage" }}

{{ $content := .currentItem }}

{{ $lazy := true }}

{{ if eq .index 0 }}
  {{ $lazy = false }}
{{ end }}

{{ partial "content/banner-image.html" (dict "content" $content "size" "large" "lazy" $lazy) }}

<div class="text-white row align-items-end card-img-overlay">
  <div class="d-flex background">
    <div class="me-auto align-self-center">
      <h1 class="card-title">
        {{ .currentItem.Title }}
      </h1>
      <p class="d-none d-lg-block">
        {{ .currentItem.Params.Description | markdownify }}
      </p>
    </div>
  </div>
</div>
</a>

{{ end }}

{{ define "main" }}
  <div class="container" align="center">
    <div class="container">
      <div class="row g-2">   
        {{ $blogs := where (where $.Site.RegularPages "Section" "blog") ".Params.upcoming" "!=" true }}
        {{ $episodes := (where (where $.Site.RegularPages "Section" "episode") ".Params.upcoming" "!=" true) }}
        {{ $talks := where (where $.Site.RegularPages "Section" "talk") ".Params.upcoming" "!=" true }}
        {{ $all := (union $talks (union $blogs $episodes)).ByDate.Reverse }}

        {{ $paginator := .Paginate $all }}
        
        {{ range $index, $value := $paginator.Pages }}
          {{- partial "cards/content-card.html" (dict "content" .) -}}
          {{ if not (modBool $index 2 )}}  
            <div class="dropdown-divider"></div>
          {{ else }}
            <div class="dropdown-divider d-block d-sm-block d-md-none"></div>
          {{ end }}
        {{ end }}

        {{- partial "paginator.html" . -}}
      </div>
    </div>
  </div>
{{ end }}